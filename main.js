(()=>{"use strict";const t=async t=>{try{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"}),a=await e.json(),r=await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${a.coord.lat}&lon=${a.coord.lon}&exclude=current,minutely,hourly,alerts&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"});return{weatherData:a,forecastData:await r.json()}}catch(t){}},e=async t=>{try{return await Promise.allSettled(t.map((async t=>{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"});return await e.json()})))}catch(t){}},a=t=>{let e=t;return"fahrenheit"===document.querySelector(".current-info__switch-units").dataset.unit&&(e=1.8*e+32),e=Math.round(e),e>0?`+${e}°`:`${e}°`},r=t=>{for(let e=0;e<t.length;e++){const r=document.querySelector(".weather__favorites"),o=document.createElement("article"),n=document.createElement("p"),i=document.createElement("span"),c=document.createElement("span"),s=document.createElement("p");o.setAttribute("class","favorites__city favorites__city--shrink"),o.setAttribute("data-listener","none"),o.setAttribute("data-city",`${t[e].value.name}`),o.setAttribute("tabindex","0"),n.setAttribute("class","city__weather-wrapper"),i.setAttribute("class","weather-wrapper__name"),c.setAttribute("class","weather-wrapper__temp unit"),s.setAttribute("class","city__status"),i.textContent=t[e].value.name,c.textContent=a(t[e].value.main.temp),c.setAttribute("data-temp",t[e].value.main.temp),s.textContent=t[e].value.weather[0].description,r.appendChild(o),o.appendChild(n),n.appendChild(i),n.appendChild(c),o.appendChild(s),setTimeout((()=>{o.classList.toggle("favorites__city--shrink")}),50)}},o=t=>{const e=document.querySelector(".weather__location"),r=document.querySelector(".current-info__status"),o=document.querySelector(".current-info__temp"),n=document.querySelector(".feel__temp");e.textContent=t.name,r.textContent=t.weather[0].description,o.textContent=a(t.main.temp),o.setAttribute("data-temp",t.main.temp),n.textContent=a(t.main.feels_like),n.setAttribute("data-temp",t.main.feels_like)},n=t=>{const e=document.querySelectorAll(".weather-wrapper__week-day"),r=document.querySelectorAll(".weather-wrapper__temp-day"),o=document.querySelectorAll(".weather-wrapper__temp-night"),n=document.querySelectorAll(".forecast-info__status");for(let c=0;c<7;c++){const s=new Date((new Date).setDate((new Date).getDate()+c)).getDate();e[c].textContent=`${i=t.daily[c].dt,["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Math.floor(i/86400+4)%7]}, ${s}`,r[c].textContent=a(t.daily[c].temp.day),r[c].setAttribute("data-temp",t.daily[c].temp.day),o[c].textContent=a(t.daily[c].temp.night),o[c].setAttribute("data-temp",t.daily[c].temp.night),n[c].textContent=t.daily[c].weather[0].description}var i},i=t=>{const e=document.querySelectorAll(".day__details"),r=document.querySelectorAll(".item__wind"),o=document.querySelectorAll(".item__pressure"),n=document.querySelectorAll(".item__humidity"),i=document.querySelectorAll(".item__uvi"),c=document.querySelectorAll(".item__temp-morning"),s=document.querySelectorAll(".item__temp-day"),l=document.querySelectorAll(".item__temp-evening"),u=document.querySelectorAll(".item__temp-night");for(let d=0;d<e.length;d++)r[d].textContent=`${Math.round(t.daily[d].wind_speed)}m/s`,o[d].textContent=Math.round(.75*t.daily[d].pressure),n[d].textContent=`${t.daily[d].humidity}%`,i[d].textContent=Math.round(10*t.daily[d].uvi)/10,c[d].textContent=a(t.daily[d].temp.morn),c[d].setAttribute("data-temp",t.daily[d].temp.morn),s[d].textContent=a(t.daily[d].temp.day),s[d].setAttribute("data-temp",t.daily[d].temp.day),l[d].textContent=a(t.daily[d].temp.eve),l[d].setAttribute("data-temp",t.daily[d].temp.eve),u[d].textContent=a(t.daily[d].temp.night),u[d].setAttribute("data-temp",t.daily[d].temp.night)},c=()=>{const t=JSON.parse(window.localStorage.getItem("favoriteCities"));if(null===t)return;const e=document.querySelector(".current-info__switch-favorite"),a=document.querySelector(".weather__location").textContent;t.includes(a)?e.textContent="remove city":e.textContent="save city"},s=document.querySelector(".root__weather"),l=(t,e)=>{"visible"===s.style.visibility?setTimeout((()=>{o(t),n(e),i(e),c()}),600):(o(t),n(e),i(e),c()),(t=>{document.querySelector("body").style.backgroundPosition=(t=>{if(t>30)return"0% 0%";if(t<-30)return"100% 100%";const e=50-Math.round(t/30*50);return`${e}% ${e}%`})(t.main.temp)})(t),(()=>{const t=document.querySelector(".weather__location"),e=document.querySelector(".weather__current-info"),a=document.querySelector(".weather__forecast");"visible"===s.style.visibility?(t.style.opacity="0",e.style.opacity="0",a.style.opacity="0",setTimeout((()=>{t.style.opacity="1",e.style.opacity="1",a.style.opacity="1"}),800)):(s.style.visibility="visible",s.style.opacity="1")})()},u=()=>{const t=document.querySelector(".root__error");t.style.visibility="visible",t.style.opacity="1"},d=()=>{const t=document.querySelector(".root__error");t.style.opacity="0",setTimeout((()=>{t.style.visibility="hidden"}),505)},y=()=>{const t=document.querySelectorAll(".forecast__day");setTimeout((()=>{for(let e=0;e<t.length;e++)t[e].classList.remove("forecast__day--expand")}),505)},m=()=>{const e=document.querySelectorAll('article[data-listener="none"]');for(let a=0;a<e.length;a++)e[a].setAttribute("data-listener","added"),e[a].addEventListener("click",(async()=>{const r=e[a].dataset.city,o=await t(r);l(o.weatherData,o.forecastData),y(),d(),setTimeout((()=>{window.scrollTo({top:0,behavior:"smooth"})}),300)}))};(()=>{const e=document.querySelector(".root__input-location");e.addEventListener("keydown",(async a=>{if("Enter"===a.key){try{const a=await t(e.value);l(a.weatherData,a.forecastData),y(),d()}catch(t){u()}e.value=""}}))})(),document.querySelector(".current-info__switch-units").addEventListener("click",(()=>{const t=document.querySelector(".current-info__switch-units"),e=document.querySelectorAll(".unit");"celsius"===t.dataset.unit?(t.setAttribute("data-unit","fahrenheit"),t.textContent="fahrenheit"):(t.setAttribute("data-unit","celsius"),t.textContent="celsius");for(let t=0;t<e.length;t++)e[t].style.opacity="0",setTimeout((()=>{e[t].textContent=a(e[t].dataset.temp),e[t].style.opacity="1"}),310)})),document.querySelector(".current-info__switch-favorite").addEventListener("click",(async()=>{(()=>{const t=document.querySelector(".weather__location").textContent,e=localStorage.getItem("favoriteCities");let a;a=null===e?[]:JSON.parse(e),a.includes(t)?(a=a.filter((e=>e!==t)),(t=>{const e=document.querySelector(`article[data-city="${t}"]`);e.classList.toggle("favorites__city--shrink"),setTimeout((()=>{e.remove()}),300)})(t)):a.push(t),localStorage.setItem("favoriteCities",JSON.stringify(a))})(),c();const t=JSON.parse(window.localStorage.getItem("favoriteCities"));let a=Array.from(document.querySelectorAll(".favorites__city"));a=a.map((t=>t.dataset.city));const o=t.filter((t=>!a.includes(t))),n=await e(o);r(n),m()})),(()=>{const t=document.querySelectorAll(".forecast__day");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(()=>{if(!t[e].classList.contains("forecast__day--expand"))for(let e=0;e<t.length;e++)t[e].classList.remove("forecast__day--expand");t[e].classList.toggle("forecast__day--expand")}))})(),(async()=>{const t=JSON.parse(window.localStorage.getItem("favoriteCities"));if(null===t)return;const a=await e(t);r(a),m()})(),(async()=>{try{const e=await(async()=>{try{const t=await fetch("https://geo.ipify.org/api/v1?apiKey=at_64AcmkRbuGr2kmqjoVmJzJcA21TFq",{mode:"cors"});return await t.json()}catch(t){}})(),a=await t(e.location.city);l(a.weatherData,a.forecastData)}catch(t){u()}})()})();