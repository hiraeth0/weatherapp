(()=>{"use strict";const t=async t=>{try{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"}),a=await e.json(),i=await fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${a.coord.lat}&lon=${a.coord.lon}&exclude=current,minutely,hourly,alerts&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"});return{weatherData:a,forecastData:await i.json()}}catch(t){}},e=async t=>{try{return await Promise.allSettled(t.map((async t=>{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&units=metric&appid=f9acc87cd1a8840a36703a0ef3c7fec8`,{mode:"cors"});return await e.json()})))}catch(t){}},a=t=>{for(let e=0;e<t.length;e++){const a=document.querySelector(".weather__favorites"),i=document.createElement("article"),r=document.createElement("p"),n=document.createElement("span"),o=document.createElement("span"),s=document.createElement("p");i.setAttribute("class","favorites__city favorites__city--shrink"),i.setAttribute("data-listener","none"),i.setAttribute("data-city",`${t[e].name}`),i.setAttribute("tabindex","0"),r.setAttribute("class","city__weather-wrapper"),n.setAttribute("class","weather-wrapper__name"),o.setAttribute("class","weather-wrapper__temp unit"),s.setAttribute("class","city__status"),n.textContent=t[e].name,o.textContent=t[e].temp.currentUnits,o.setAttribute("data-celsius",t[e].temp.celsius),o.setAttribute("data-fahrenheit",t[e].temp.fahrenheit),s.textContent=t[e].description,a.appendChild(i),i.appendChild(r),r.appendChild(n),r.appendChild(o),i.appendChild(s),setTimeout((()=>{i.classList.toggle("favorites__city--shrink")}),50)}},i=t=>{const e=document.querySelector(".weather__location"),a=document.querySelector(".current-info__status"),i=document.querySelector(".current-info__temp"),r=document.querySelector(".feel__temp");e.textContent=t.name,a.textContent=t.description,i.textContent=t.temp.currentUnits,i.setAttribute("data-celsius",t.temp.celsius),i.setAttribute("data-fahrenheit",t.temp.fahrenheit),r.textContent=t.tempFeeling.currentUnits,r.setAttribute("data-celsius",t.tempFeeling.celsius),r.setAttribute("data-fahrenheit",t.tempFeeling.fahrenheit)},r=t=>{const e=document.querySelectorAll(".weather-wrapper__week-day"),a=document.querySelectorAll(".weather-wrapper__temp-day"),i=document.querySelectorAll(".weather-wrapper__temp-night"),r=document.querySelectorAll(".forecast-info__status");for(let n=0;n<7;n++)e[n].textContent=t[n].weekDay,a[n].textContent=t[n].tempDay.currentUnits,a[n].setAttribute("data-celsius",t[n].tempDay.celsius),a[n].setAttribute("data-fahrenheit",t[n].tempDay.fahrenheit),i[n].textContent=t[n].tempNight.currentUnits,i[n].setAttribute("data-celsius",t[n].tempNight.celsius),i[n].setAttribute("data-fahrenheit",t[n].tempNight.fahrenheit),r[n].textContent=t[n].description},n=t=>{const e=document.querySelectorAll(".day__details"),a=document.querySelectorAll(".item__wind"),i=document.querySelectorAll(".item__pressure"),r=document.querySelectorAll(".item__humidity"),n=document.querySelectorAll(".item__uvi"),o=document.querySelectorAll(".item__temp-morning"),s=document.querySelectorAll(".item__temp-day"),c=document.querySelectorAll(".item__temp-evening"),l=document.querySelectorAll(".item__temp-night");for(let u=0;u<e.length;u++)a[u].textContent=t[u].wind,i[u].textContent=t[u].pressure,r[u].textContent=t[u].humidity,n[u].textContent=t[u].uvi,o[u].textContent=t[u].tempMorning.currentUnits,o[u].setAttribute("data-celsius",t[u].tempMorning.celsius),o[u].setAttribute("data-fahrenheit",t[u].tempMorning.fahrenheit),s[u].textContent=t[u].tempDay.currentUnits,s[u].setAttribute("data-celsius",t[u].tempDay.celsius),s[u].setAttribute("data-fahrenheit",t[u].tempDay.fahrenheit),c[u].textContent=t[u].tempEvening.currentUnits,c[u].setAttribute("data-celsius",t[u].tempEvening.celsius),c[u].setAttribute("data-fahrenheit",t[u].tempEvening.fahrenheit),l[u].textContent=t[u].tempNight.currentUnits,l[u].setAttribute("data-celsius",t[u].tempNight.celsius),l[u].setAttribute("data-fahrenheit",t[u].tempNight.fahrenheit)},o=()=>{const t=JSON.parse(window.localStorage.getItem("favoriteCities"));if(null===t)return;const e=document.querySelector(".current-info__switch-favorite"),a=document.querySelector(".weather__location").textContent;t.includes(a)?e.textContent="remove city":e.textContent="save city"},s=document.querySelector(".root__weather"),c=(t,e)=>{"visible"===s.style.visibility?setTimeout((()=>{i(t),r(e),n(e),o()}),600):(i(t),r(e),n(e),o()),(t=>{document.querySelector(".background").style.backgroundPosition=t.position})(t),(()=>{const t=document.querySelector(".weather__location"),e=document.querySelector(".weather__current-info"),a=document.querySelector(".weather__forecast");"visible"===s.style.visibility?(t.style.opacity="0",e.style.opacity="0",a.style.opacity="0",setTimeout((()=>{t.style.opacity="1",e.style.opacity="1",a.style.opacity="1"}),800)):(s.style.visibility="visible",s.style.opacity="1")})()},l=t=>{let e,a=Math.round(t),i=Math.round(1.8*t+32);return a=a>0?`+${a}째`:`${a}째`,i=i>0?`+${i}째`:`${i}째`,e="celsius"===document.querySelector(".current-info__switch-units").dataset.unit?a:i,{celsius:a,fahrenheit:i,currentUnits:e}},u=t=>{if(t>30)return"0% 0%";if(t<-30)return"100% 100%";const e=50-Math.round(t/30*50);return`${e}% ${e}%`},d=t=>({temp:l(t.main.temp),tempFeeling:l(t.main.feels_like),position:u(t.main.temp),name:t.name,description:t.weather[0].description}),m=t=>{const e=[];for(let i=0;i<7;i++)e.push({weekDay:(a=t.daily[i].dt,["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][Math.floor(a/86400+4)%7]),tempMorning:l(t.daily[i].temp.morn),tempDay:l(t.daily[i].temp.day),tempEvening:l(t.daily[i].temp.eve),tempNight:l(t.daily[i].temp.night),description:t.daily[i].weather[0].description,wind:`${Math.round(t.daily[i].wind_speed)}m/s`,pressure:Math.round(.75*t.daily[i].pressure),humidity:`${t.daily[i].humidity}%`,uvi:Math.round(10*t.daily[i].uvi)/10});var a;return e},y=t=>{const e=document.querySelector(".root__error");e.textContent=t,e.style.visibility="visible",e.style.opacity="1"},p=()=>{const t=document.querySelector(".root__error");t.style.opacity="0",setTimeout((()=>{t.style.visibility="hidden"}),505)},h=()=>{const t=document.querySelectorAll(".forecast__day");setTimeout((()=>{for(let e=0;e<t.length;e++)t[e].classList.remove("forecast__day--expand")}),505)},f=()=>{const e=document.querySelectorAll('article[data-listener="none"]');for(let a=0;a<e.length;a++)e[a].setAttribute("data-listener","added"),e[a].addEventListener("click",(async()=>{const i=e[a].dataset.city,r=await t(i),n=d(r.weatherData);console.log(n);const o=m(r.forecastData);c(n,o),h(),p(),setTimeout((()=>{window.scrollTo({top:0,behavior:"smooth"})}),300)}))};(()=>{const t=document.querySelectorAll(".forecast__day");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(()=>{if(!t[e].classList.contains("forecast__day--expand"))for(let e=0;e<t.length;e++)t[e].classList.remove("forecast__day--expand");t[e].classList.toggle("forecast__day--expand")}))})(),document.querySelector(".current-info__switch-units").addEventListener("click",(()=>{const t=document.querySelector(".current-info__switch-units"),e=document.querySelectorAll(".unit");if("celsius"===t.dataset.unit){t.setAttribute("data-unit","fahrenheit"),t.textContent="fahrenheit";for(let t=0;t<e.length;t++)e[t].style.opacity="0",setTimeout((()=>{e[t].textContent=e[t].dataset.fahrenheit,e[t].style.opacity="1"}),310)}else{t.setAttribute("data-unit","celsius"),t.textContent="celsius";for(let t=0;t<e.length;t++)e[t].style.opacity="0",setTimeout((()=>{e[t].textContent=e[t].dataset.celsius,e[t].style.opacity="1"}),310)}})),(()=>{const e=document.querySelector(".root__input-location");e.addEventListener("keydown",(async a=>{if("Enter"===a.key){try{const a=await t(e.value),i=d(a.weatherData),r=m(a.forecastData);c(i,r),h(),p()}catch(t){y("location not found")}e.value=""}}))})(),document.querySelector(".current-info__switch-favorite").addEventListener("click",(async()=>{(()=>{const t=document.querySelector(".weather__location").textContent,e=localStorage.getItem("favoriteCities");let a;a=null===e?[]:JSON.parse(e),a.includes(t)?(a=a.filter((e=>e!==t)),(t=>{const e=document.querySelector(`article[data-city="${t}"]`);e.classList.toggle("favorites__city--shrink"),setTimeout((()=>{e.remove()}),300)})(t)):a.push(t),localStorage.setItem("favoriteCities",JSON.stringify(a))})(),o();const t=JSON.parse(window.localStorage.getItem("favoriteCities"));let i=Array.from(document.querySelectorAll(".favorites__city"));i=i.map((t=>t.dataset.city));const r=t.filter((t=>!i.includes(t))),n=(await e(r)).map((t=>d(t.value)));a(n),f()})),(()=>{if(null===JSON.parse(window.localStorage.getItem("favoriteCities"))){const t=JSON.stringify(["Perth","London","Yakutsk"]);localStorage.setItem("favoriteCities",t)}})(),(async()=>{const t=JSON.parse(window.localStorage.getItem("favoriteCities"));if(null===t||t===[])return;const i=(await e(t)).map((t=>d(t.value)));a(i),f()})(),(async()=>{try{const e=await(async()=>{try{const t=await fetch("https://geo.ipify.org/api/v1?apiKey=at_64AcmkRbuGr2kmqjoVmJzJcA21TFq",{mode:"cors"});return await t.json()}catch(t){}})(),a=await t(e.location.city),i=d(a.weatherData),r=m(a.forecastData);c(i,r)}catch(t){y("could not get location by IP address")}})()})();