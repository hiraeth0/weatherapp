(()=>{"use strict";const t=async(t,e,n)=>{const a={method:"POST",mode:"cors",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({url:t,method:e,...n&&{realBody:n}})};try{const t=await fetch("/.netlify/functions/fetch-data",a);if(!t.ok)throw new Error(t.status);const e=await t.json();return Object.values(e)[0]}catch(t){throw new Error(t)}},e=(()=>{let t="c";return{get units(){return t},convert(e){let n,a=Math.round(e),r=Math.round(1.8*e+32);return a=a>0?`+${a}째`:`${a}째`,r=r>0?`+${r}째`:`${r}째`,"c"===t?n=a:"f"===t&&(n=r),{celsius:a,fahrenheit:r,currentUnits:n}},switchUnits(){"c"===t?t="f":"f"===t&&(t="c")}}})(),n=t=>{if(t>30)return"0% 0%";if(t<-30)return"100% 100%";const e=50-Math.round(t/30*50);return`${e}% ${e}%`},a=t=>{const e=new Date(1e3*t);return`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()]}, ${e.getDate()}`},r=t=>({temp:e.convert(t.main.temp),tempFeeling:e.convert(t.main.feels_like),position:n(t.main.temp),name:t.name,description:t.weather[0].description}),i=(()=>{const t=document.querySelector(".search__error");let e;return{show(n="Something went wrong!"){clearTimeout(e),t.textContent=n,t.classList.remove("invisible"),e=setTimeout((()=>{this.hide()}),4e3)},hide(){t.classList.add("invisible")}}})(),s={data:null,async get(n){try{const i=await t(`https://api.openweathermap.org/data/2.5/weather?q=${n}&units=metric`,"GET"),s=await t(`https://api.openweathermap.org/data/2.5/onecall?lat=${i.coord.lat}&lon=${i.coord.lon}&exclude=current,minutely,hourly,alerts&units=metric`,"GET"),o=r(i),c=(t=>{const n=[];for(let r=0;r<7;r+=1)n.push({weekDay:a(t.daily[r].dt),tempMorning:e.convert(t.daily[r].temp.morn),tempDay:e.convert(t.daily[r].temp.day),tempEvening:e.convert(t.daily[r].temp.eve),tempNight:e.convert(t.daily[r].temp.night),description:t.daily[r].weather[0].description,wind:`${Math.round(t.daily[r].wind_speed)}m/s`,pressure:Math.round(.75*t.daily[r].pressure),humidity:`${t.daily[r].humidity}%`,uvi:Math.round(10*t.daily[r].uvi)/10});return n})(s);this.data={current:o,forecast:c}}catch(t){this.data=null,i.show("Location not found")}}},o={data:null,async get(e){const n=(await Promise.allSettled(e.map((async e=>await t(`https://api.openweathermap.org/data/2.5/weather?q=${e}&units=metric`,"GET"))))).map((t=>r(t.value)));this.data=n}},c=(()=>{const t=()=>JSON.parse(localStorage.getItem("cities")),e=t=>localStorage.setItem("cities",JSON.stringify(t));return null===t()&&e(["Moscow","London","New York"]),{get cities(){return t()},add(n){const a=t();a.find((t=>t===n))||(a.push(n),e(a))},remove(n){const a=t().filter((t=>t!==n));e(a)},isIncluded:e=>t().includes(e)}})(),d=(()=>{const t=document.querySelector(".container"),e=document.createElement("div"),n=document.createElement("div");return e.classList.add("loading"),n.classList.add("loading__animation"),e.appendChild(n),{mount(){t.classList.add("hidden"),t.after(e)},unmount(){t.classList.remove("hidden"),e.remove()}}})(),u=t=>{const e=document.querySelector(".weather__switch-favorite");c.isIncluded(t)?e.textContent="remove city":e.textContent="save city"},l=t=>{var e;(t=>{const e=document.querySelector(".location"),n=document.querySelector(".weather__status"),a=document.querySelector(".weather__temp"),r=document.querySelector(".weather__feel-temp");e.textContent=t.name,n.textContent=t.description,a.textContent=t.temp.currentUnits,r.textContent=t.tempFeeling.currentUnits,a.setAttribute("data-celsius",t.temp.celsius),a.setAttribute("data-fahrenheit",t.temp.fahrenheit),r.setAttribute("data-celsius",t.tempFeeling.celsius),r.setAttribute("data-fahrenheit",t.tempFeeling.fahrenheit)})(t.current),(t=>{const e=document.querySelectorAll(".day__week-day"),n=document.querySelectorAll(".day__temp-day"),a=document.querySelectorAll(".day__temp-night"),r=document.querySelectorAll(".day__status");for(let i=0;i<7;i+=1)e[i].textContent=t[i].weekDay,n[i].textContent=t[i].tempDay.currentUnits,a[i].textContent=t[i].tempNight.currentUnits,r[i].textContent=t[i].description,n[i].setAttribute("data-celsius",t[i].tempDay.celsius),n[i].setAttribute("data-fahrenheit",t[i].tempDay.fahrenheit),a[i].setAttribute("data-celsius",t[i].tempNight.celsius),a[i].setAttribute("data-fahrenheit",t[i].tempNight.fahrenheit)})(t.forecast),(t=>{const e=document.querySelectorAll(".details"),n=document.querySelectorAll(".details__wind"),a=document.querySelectorAll(".details__pressure"),r=document.querySelectorAll(".details__humidity"),i=document.querySelectorAll(".details__uvi"),s=document.querySelectorAll(".details__temp-morning"),o=document.querySelectorAll(".details__temp-day"),c=document.querySelectorAll(".details__temp-evening"),d=document.querySelectorAll(".details__temp-night");for(let u=0;u<e.length;u+=1)n[u].textContent=t[u].wind,a[u].textContent=t[u].pressure,r[u].textContent=t[u].humidity,i[u].textContent=t[u].uvi,s[u].textContent=t[u].tempMorning.currentUnits,o[u].textContent=t[u].tempDay.currentUnits,c[u].textContent=t[u].tempEvening.currentUnits,d[u].textContent=t[u].tempNight.currentUnits,s[u].setAttribute("data-celsius",t[u].tempMorning.celsius),s[u].setAttribute("data-fahrenheit",t[u].tempMorning.fahrenheit),o[u].setAttribute("data-celsius",t[u].tempDay.celsius),o[u].setAttribute("data-fahrenheit",t[u].tempDay.fahrenheit),c[u].setAttribute("data-celsius",t[u].tempEvening.celsius),c[u].setAttribute("data-fahrenheit",t[u].tempEvening.fahrenheit),d[u].setAttribute("data-celsius",t[u].tempNight.celsius),d[u].setAttribute("data-fahrenheit",t[u].tempNight.fahrenheit)})(t.forecast),u(t.current.name),e=t.current.position,document.querySelector(".background").style.backgroundPosition=e},m=t=>{for(let e=0;e<t.length;e+=1){const n=document.querySelector(".favorites"),a=document.createElement("article"),r=document.createElement("div"),i=document.createElement("span"),o=document.createElement("span"),c=document.createElement("div");i.textContent=t[e].name,o.textContent=t[e].temp.currentUnits,c.textContent=t[e].description,a.classList.add("city"),r.classList.add("city__weather"),i.classList.add("city__name"),o.classList.add("city__temp","unit"),c.classList.add("city__status"),a.setAttribute("data-city",t[e].name),a.setAttribute("tabindex","0"),o.setAttribute("data-celsius",t[e].temp.celsius),o.setAttribute("data-fahrenheit",t[e].temp.fahrenheit),n.appendChild(a),a.appendChild(r),r.appendChild(i),r.appendChild(o),a.appendChild(c),a.addEventListener("click",(async()=>{d.mount(),await s.get(t[e].name),s.data&&(window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".day").forEach((t=>t.classList.remove("day--expand"))),l(s.data)),d.unmount()}))}};!function(){const t=document.querySelectorAll(".day"),n=document.querySelector(".weather__switch-units"),a=document.querySelector(".search__input"),r=document.querySelector(".weather__switch-favorite");t.forEach((t=>t.addEventListener("click",(()=>t.classList.toggle("day--expand"))))),n.addEventListener("click",(()=>{const t=document.querySelector(".weather__switch-units"),n=document.querySelectorAll(".unit");e.switchUnits(),"c"===e.units?(t.textContent="celsius",n.forEach((t=>{t.textContent=t.dataset.celsius}))):"f"===e.units&&(t.textContent="fahrenheit",n.forEach((t=>{t.textContent=t.dataset.fahrenheit})))})),a.addEventListener("keydown",(async e=>{if("Enter"===e.key){const e=a.value.trim();if(a.value="",e.length<1)return void i.show("No empty queries!");i.hide(),d.mount(),await s.get(e),s.data&&(t.forEach((t=>t.classList.remove("day--expand"))),l(s.data)),d.unmount()}})),r.addEventListener("click",(async()=>{const t=s.data.current.name;c.isIncluded(t)?(c.remove(t),document.querySelector(`article[data-city="${t}"]`).remove()):(c.add(t),await o.get([t]),o.data&&m(o.data)),u(t)}))}(),async function(){d.mount(),await s.get("Saint Petersburg"),s.data&&l(s.data),await o.get(c.cities),o.data&&m(o.data),d.unmount()}()})();